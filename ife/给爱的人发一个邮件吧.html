<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
       *{
           margin: 0;
           padding: 0;
           list-style: none;
        }
        .email-input {
            width: 250px;
            height: 35px;
            line-height: 35px;
            margin: 25px;
            font-size: 18px;
            text-indent: 0.5em;
            overflow: hidden;
        }
        .email-sug {
            display: none;
        }
        .active {
            background-color:purple;
        }
        li {
            width: 254px;
            height: 25px;
            line-height: 25px;
            border: 1px solid black;
            text-indent: .5em;
            overflow: hidden;
            cursor: pointer;
            margin: 0 25px;
        }
        li:hover {
            background-color: orangered;
        }

    </style>
</head>
<body>
    <div class="wrapper">
        <input id="email-input" class="email-input" type="text">
        <ul id="email-sug-wrapper" class="email-sug"></ul>
    </div>
   
     <script>
        /**
        来源:http://ife.baidu.com/course/detail/id/52

        当用户没有任何输入时，提示框消失
        当用户输入字符后，显示提示框，并且把用户输入的内容自动拼上邮箱后缀进行显示
        暂时不用考虑示意图中的红色和蓝色背景色的逻辑
        注意用户输入中前后空格需要去除
        尝试用keyup, keypress, keydown以及oninput四个事件分别来测试对于用户输入的事件监听
        使用CSS实现：鼠标滑过提示框的某一个提示时，这个提示内容背景色变化，表示鼠标经过了这个DOM节点
        鼠标如果点击某个提示，则提示内容进入输入框，同时提示框消失
        **/
        var input = document.getElementById('email-input');
        var oUI = document.getElementById('email-sug-wrapper');
        var lis = document.getElementsByTagName("li");
        var postfixList = ['163.com','gmail.com','126.com','qq.com','263.net'];
        var tipIndex = 0; //用于存储当前选中的提示Li的序号
        input.focus(); //一进入页面就将焦点放在输入框中

        input.oninput = function(e) {
            addPrompt();
            state(input.value);
        } 

        //通过键盘进行选择
        input.onkeydown = function (e) {
            //上
            if (oUI.style.display == "block") {// 判断提示框是否存在
               if (e.keyCode === 38) {
                    if (tipIndex === 0) {
                       tipIndex = lis.length - 1
                    }else {
                        tipIndex--
                    }
               }
               //下
                if (e.keyCode === 40) {
                    if (tipIndex === lis.length - 1) {
                       tipIndex = 0;
                    }else {
                       tipIndex++
                    }
                }
                //ESC
                if (e.keyCode === 27) {
                    input.select()
                }
                //回车
                if (e.keyCode === 13) {
                    var content = lis[tipIndex].innerHTML;
                    input.value = HtmlUtil.htmlDecode(content);
                    hide()
                }
                //重置
                if (e.keyCode !== 13 && e.keyCode !== 38 && e.keyCode !== 40 && e.keyCode !== 27) {
                    tipIndex = 0
                }
                addPrompt();


            }
        }
    
        // 单击提示框进行选择

        oUI.onclick = function (e) {
            var target = e.target;
            if (target.nodeName.toLowerCase() === "li") {
                var content = target.innerHTML;
                input.value = HtmlUtil.htmlDecode(content);
                hide();
            }
            input.focus();
        } 
        //获取用户输入
        function getInput(x) {
            return x.replace(/^\s+|\s+$/gm,'')
        }
        //生成提示框中的提示内容，将内容添加
        function setProm() {
            var inputVal = getInput(input.value);
            var prefix = getInput(input.value);
            var postfix = "";
            var content1 = "";
            var content2 = "";

            if (inputVal.indexOf('@') != -1) {
                prefix = inputVal.split('@')[0];
                postfix = inputVal.split('@')[1];
            }

            for (var i = 0; i < postfixList.length; i++) {
                if (postfix) {
                    if (postfixList[i].indexOf(postfix) === 0) {
                        var email = prefix + '@' + postfixList[i];
                        email = HtmlUtil.htmlEncode(email);
                        content1 += "<li>" + email + "</li>";
                    }
                }
                var email = prefix + '@' + postfixList[i];
                email = HtmlUtil.htmlEncode(email);
                content2 += "<li>" + email + "</li>";
            }
            return content1.length > 0 ?content1 : content2;
        }
        //添加提示内容
        function addPrompt() {
            oUI.innerHTML = setProm();
            lis[tipIndex].setAttribute('class','active');
        }

        //显示/隐藏状态

        function state(x) {
            if (x == "") {
                hide()
            }else {
                show()
            }
        }

        function hide() {
            oUI.style.display = 'none'
        }

        function show() {
            oUI.style.display = 'block'
        }

        //转码和解码
        var HtmlUtil = {
            //html转码
            htmlEncode: function (html) {
                var temp = document.createElement('div');
                (temp.textContent != undefined) ? (temp.textContent = html) : (temp.innerText = html)
                var output = temp.innerHTML;
                temp = null;
                return output;
            },
            //html解码
            htmlDecode:function (text) {
                var temp = document.createElement("div");
                temp.innerHTML = text;
                var output = temp.innerText || temp.textContent;
                temp = null;
                return output;
            }
        }
        
    </script>

</body>
</html>